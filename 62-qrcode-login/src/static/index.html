<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>æ‰«ç ç™»å½•</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://unpkg.com/axios@1.5.0/dist/axios.min.js"></script>
  </head>
  <body>
    <img id="img" src="" alt="" />
    <h2 id="info"></h2>

    <script>
      axios.get('http://localhost:3000/qrcode/generate').then((res) => {
        console.log('ğŸš€ ~ file: index.html ~ line 14 ~ axios.get ~ res', res);
        document.getElementById('img').src = res.data.dataUrl;
        queryStatus(res.data.qrcode_id);
      });

      function queryStatus(id) {
        axios.get('http://localhost:3000/qrcode/check?id=' + id).then((res) => {
          const status = res.data.status;

          let content = '';
          switch (status) {
            case 'noscan':
              content = 'æœªæ‰«ç ';
              break;
            case 'scan-wait-confirm':
              content = 'å·²æ‰«ç ï¼Œç­‰å¾…ç¡®è®¤';
              break;
            case 'scan-confirm':
              content = 'å·²ç¡®è®¤, å½“å‰ç™»å½•ç”¨æˆ·: ' + res.data.userInfo.username;
              break;
            case 'scan-cancel':
              content = 'å·²å–æ¶ˆ';
              break;
          }
          document.getElementById('info').textContent = content;

          if (status === 'noscan' || status === 'scan-wait-confirm') {
            setTimeout(() => queryStatus(id), 1000);
          }
        });
      }
    </script>
  </body>
</html>
